<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    
    <style>
        /* === Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ø§Ù…Ø© === */
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3a1;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 10px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* === Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ === */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* === Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© === */
        .sync-status-bar {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            font-size: 14px;
        }
        
        .sync-online {
            border-right: 4px solid #28a745;
        }
        
        .sync-offline {
            border-right: 4px solid #dc3545;
        }
        
        .sync-pending {
            border-right: 4px solid #ffc107;
        }
        
        /* === Ø§Ù„ÙˆØ¶Ø¹ === */
        .mode-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .mode-btn {
            padding: 12px 30px;
            border: none;
            background: #e9ecef;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .mode-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .mode-btn:first-child {
            border-radius: var(--border-radius) 0 0 var(--border-radius);
        }
        
        .mode-btn:last-child {
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        
        /* === Ø§Ù„Ù‡ÙŠØ¯Ø± === */
        header {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            text-align: center;
            border-right: 5px solid var(--primary-color);
        }
        
        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* === Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª === */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        .tab-btn {
            padding: 12px 25px;
            background: var(--light-color);
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* === Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª === */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* === Ø§Ù„ÙƒØ±ÙˆØª === */
        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary-color);
        }
        
        .card h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 1rem;
        }
        
        /* === Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ === */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        /* === Ø§Ù„Ø£Ø²Ø±Ø§Ø± === */
        .btn-primary {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.2);
        }
        
        .btn-secondary {
            background: var(--light-color);
            color: var(--dark-color);
            border: 2px solid #ddd;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
            border-color: var(--primary-color);
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            background: #e11d48;
            transform: translateY(-2px);
        }
        
        /* === Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ === */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        table th {
            background: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: right;
            font-weight: bold;
        }
        
        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        table tr:hover {
            background: #f8f9fa;
        }
        
        table tr:last-child td {
            border-bottom: none;
        }
        
        /* === ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ === */
        .student-login {
            max-width: 500px;
            margin: 50px auto;
        }
        
        .exam-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .question-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-color);
        }
        
        .question-number {
            background: var(--primary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .options-container {
            margin: 20px 0;
        }
        
        .option-label {
            display: block;
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option-label:hover {
            background: #f8f9fa;
        }
        
        .option-label.selected {
            border-color: var(--primary-color);
            background: #e3f2fd;
        }
        
        /* === Ù…Ø¤Ù‚Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± === */
        .exam-timer {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--danger-color);
            color: white;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 1000;
            box-shadow: var(--shadow);
        }
        
        /* === Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ === */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-right: 4px solid #10b981;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-right: 4px solid #f59e0b;
        }
        
        .alert-danger {
            background: #fee2e2;
            color: #991b1b;
            border-right: 4px solid #ef4444;
        }
        
        /* === Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© === */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                width: 100%;
                justify-content: center;
            }
            
            .mode-selector {
                flex-direction: column;
            }
            
            .mode-btn {
                border-radius: var(--border-radius) !important;
                margin-bottom: 5px;
            }
            
            .exam-timer {
                position: static;
                margin-bottom: 20px;
            }
            
            header h1 {
                font-size: 1.4rem;
            }
            
            .sync-status-bar {
                position: static;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...</p>
        <p id="loaderStatus" style="margin-top: 10px; color: #666; font-size: 14px;"></p>
    </div>
    
    <!-- Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
    <div class="sync-status-bar sync-pending" id="syncStatusBar">
        <i class="fas fa-sync-alt fa-spin"></i>
        <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>
    
    <!-- Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="container" id="appContainer" style="display: none;">
        <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¶Ø¹ -->
        <div class="mode-selector">
            <button class="mode-btn active" onclick="switchMode('teacher')">
                <i class="fas fa-chalkboard-teacher"></i> ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…
            </button>
            <button class="mode-btn" onclick="switchMode('student')">
                <i class="fas fa-user-graduate"></i> ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨
            </button>
        </div>
        
        <!-- ===== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø¹Ù„Ù… ===== -->
        <div id="teacherMode">
            <!-- Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…Ø¹Ù„Ù… -->
            <header>
                <h1><i class="fas fa-chalkboard-teacher"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ - Ø§Ù„Ù…Ø¹Ù„Ù…</h1>
                <p id="currentDate"></p>
                <div style="margin-top: 10px;">
                    <button class="btn-primary" onclick="forceSync()" style="padding: 8px 15px;">
                        <i class="fas fa-sync-alt"></i> Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ©
                    </button>
                    <span id="lastSyncTime" style="margin-right: 15px; font-size: 14px; color: #666;"></span>
                </div>
            </header>
            
            <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù… -->
            <nav class="tabs">
                <button class="tab-btn active" data-tab="students"><i class="fas fa-users"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</button>
                <button class="tab-btn" data-tab="questions"><i class="fas fa-question-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
                <button class="tab-btn" data-tab="exams"><i class="fas fa-file-alt"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
                <button class="tab-btn" data-tab="results"><i class="fas fa-chart-bar"></i> Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            </nav>
            
            <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ -->
            <div class="tab-content active" id="students">
                <div class="card">
                    <h2><i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                    <div class="form-group">
                        <label for="studentName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
                        <input type="text" id="studentName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>
                    
                    <div class="form-group">
                        <label for="studentCivilId">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ:</label>
                        <input type="text" id="studentCivilId" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ">
                    </div>
                    
                    <div class="form-group">
                        <label for="studentClass">Ø§Ù„ØµÙ:</label>
                        <select id="studentClass" class="form-control">
                            <option value="Ø§Ù„Ø³Ø§Ø¯Ø³ Ø£">Ø§Ù„Ø³Ø§Ø¯Ø³ Ø£</option>
                            <option value="Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¨">Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¨</option>
                            <option value="Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø£">Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø£</option>
                            <option value="Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¨">Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¨</option>
                            <option value="Ø§Ù„Ø«Ø§Ù…Ù† Ø£">Ø§Ù„Ø«Ø§Ù…Ù† Ø£</option>
                            <option value="Ø§Ù„Ø«Ø§Ù…Ù† Ø¨">Ø§Ù„Ø«Ø§Ù…Ù† Ø¨</option>
                        </select>
                    </div>
                    
                    <button class="btn-primary" onclick="addStudent()">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù„Ø¨
                    </button>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-users"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h2>
                    <div id="studentsTable"></div>
                </div>
            </div>
            
            <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
            <div class="tab-content" id="questions">
                <div class="card">
                    <h2><i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h2>
                    
                    <div class="form-group">
                        <label for="questionText">Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                        <textarea id="questionText" class="form-control" rows="3" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="questionType">Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                        <select id="questionType" class="form-control" onchange="toggleQuestionOptions()">
                            <option value="mcq">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                            <option value="essay">Ø³Ø¤Ø§Ù„ Ù…Ù‚Ø§Ù„ÙŠ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="questionSubject">Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
                        <select id="questionSubject" class="form-control">
                            <option value="Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                            <option value="Ø¹Ù„ÙˆÙ…">Ø¹Ù„ÙˆÙ…</option>
                            <option value="Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©">Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©</option>
                            <option value="Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="questionScore">Ø§Ù„Ø¯Ø±Ø¬Ø©:</label>
                        <input type="number" id="questionScore" class="form-control" value="1" min="1">
                    </div>
                    
                    <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ -->
                    <div id="mcqOptions" style="display: block;">
                        <h3><i class="fas fa-list-ol"></i> Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</h3>
                        
                        <div id="optionsContainer">
                            <div class="option-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <input type="radio" name="correctOption" value="0" checked>
                                <input type="text" class="form-control option-text" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„" data-index="0">
                                <button class="btn-danger" onclick="removeOption(0)" style="padding: 5px 10px;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="option-item" style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <input type="radio" name="correctOption" value="1">
                                <input type="text" class="form-control option-text" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ" data-index="1">
                                <button class="btn-danger" onclick="removeOption(1)" style="padding: 5px 10px;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <button class="btn-secondary" onclick="addOption()">
                            <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±
                        </button>
                    </div>
                    
                    <!-- Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠ -->
                    <div id="essayOptions" style="display: none;">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> ÙŠÙ…ÙƒÙ† Ù„Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù†ØµÙŠØ©
                        </div>
                    </div>
                    
                    <button class="btn-primary" onclick="saveQuestion()" style="margin-top: 20px;">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„
                    </button>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-question-circle"></i> Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
                    <div id="questionsTable"></div>
                </div>
            </div>
            
            <!-- ØªØ¨ÙˆÙŠØ¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª -->
            <div class="tab-content" id="exams">
                <div class="card">
                    <h2><i class="fas fa-plus-circle"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</h2>
                    
                    <div class="form-group">
                        <label for="examName">Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</label>
                        <input type="text" id="examName" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†ØªØµÙ Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„">
                    </div>
                    
                    <div class="form-group">
                        <label for="examSubject">Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
                        <select id="examSubject" class="form-control">
                            <option value="Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                            <option value="Ø¹Ù„ÙˆÙ…">Ø¹Ù„ÙˆÙ…</option>
                            <option value="Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©">Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ©</option>
                            <option value="Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="examDuration">Ù…Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¯Ù‚Ø§Ø¦Ù‚):</label>
                        <input type="number" id="examDuration" class="form-control" value="60" min="5">
                    </div>
                    
                    <div class="form-group">
                        <label for="examDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</label>
                        <input type="date" id="examDate" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</label>
                        <div id="questionsList" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: var(--border-radius);"></div>
                    </div>
                    
                    <button class="btn-primary" onclick="createExam()">
                        <i class="fas fa-save"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    </button>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-list-alt"></i> Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©</h2>
                    <div id="examsTable"></div>
                </div>
            </div>
            
            <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
            <div class="tab-content" id="results">
                <div class="card">
                    <h2><i class="fas fa-chart-pie"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
                    <div id="statsGrid"></div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-table"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                    <div id="resultsTable"></div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-cloud-download-alt"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                    <div class="sync-actions">
                        <button class="btn-primary" onclick="exportResults()">
                            <i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                        </button>
                        <button class="btn-secondary" onclick="exportStudents()">
                            <i class="fas fa-users"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø§Ø¨
                        </button>
                        <button class="btn-secondary" onclick="backupData()">
                            <i class="fas fa-database"></i> Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ===== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ ===== -->
        <div id="studentMode" style="display: none;">
            <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div id="studentLoginScreen">
                <div class="student-login">
                    <div class="card">
                        <h2><i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                        
                        <div class="form-group">
                            <label for="loginCivilId">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ:</label>
                            <input type="text" id="loginCivilId" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ">
                        </div>
                        
                        <div class="form-group">
                            <label for="loginExamCode">ÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</label>
                            <input type="text" id="loginExamCode" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±">
                        </div>
                        
                        <button class="btn-primary" onclick="studentLogin()">
                            <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </button>
                        
                        <div id="loginError" class="alert alert-danger" style="display: none; margin-top: 20px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
            <div id="studentExamScreen" style="display: none;">
                <div class="exam-container">
                    <!-- Ù…Ø¤Ù‚Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
                    <div class="exam-timer" id="examTimer">
                        <i class="fas fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timeRemaining">60:00</span>
                    </div>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
                    <div class="card">
                        <h2><i class="fas fa-user-graduate"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
                        <p><strong>Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> <span id="studentInfo">-</span></p>
                        <p><strong>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong> <span id="examInfo">-</span></p>
                        <p><strong>Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> <span id="subjectInfo">-</span></p>
                        <p><strong>ÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong> <span id="examCodeInfo">-</span></p>
                    </div>
                    
                    <!-- Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
                    <div id="examQuestionsContainer"></div>
                    
                    <!-- Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <button class="btn-secondary" onclick="previousQuestion()" id="prevBtn" disabled>
                                <i class="fas fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
                            </button>
                            
                            <span id="questionCounter">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 10</span>
                            
                            <button class="btn-secondary" onclick="nextQuestion()" id="nextBtn">
                                Ø§Ù„ØªØ§Ù„ÙŠ <i class="fas fa-arrow-left"></i>
                            </button>
                        </div>
                        
                        <button class="btn-primary" onclick="submitExam()" style="width: 100%;">
                            <i class="fas fa-paper-plane"></i> ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
            <div id="studentResultScreen" style="display: none;">
                <div class="student-login">
                    <div class="card">
                        <h2><i class="fas fa-check-circle"></i> ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
                        <div class="alert alert-success">
                            <i class="fas fa-check"></i> ØªÙ… ØªØ³Ù„ÙŠÙ… Ø¥Ø¬Ø§Ø¨Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­
                        </div>
                        
                        <div id="resultDetails" style="margin-top: 20px;"></div>
                        
                        <button class="btn-primary" onclick="backToLogin()" style="margin-top: 20px;">
                            <i class="fas fa-redo"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase =====
        // ğŸ”¥ Ø¶Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù‡Ù†Ø§ ğŸ”¥
        const firebaseConfig = {
            apiKey: "AIzaSyB_ZgwQhrIulXfbkR7tvPYqJjuUtMSuIX8",
           authDomain: "alhosin-2be4c.firebaseapp.com",
           projectId: "alhosin-2be4c",
           storageBucket: "alhosin-2be4c.firebasestorage.app",
           messagingSenderId: "13131661059",
           appId: "1:13131661059:web:bb3e7419e573e4c66ff336",
           measurementId: "G-Q9H57NKX48"
        };
        
        // ===== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© =====
        let db;
        let isOnline = false;
        let currentMode = 'teacher';
        let students = [];
        let questions = [];
        let exams = [];
        let results = [];
        let currentStudent = null;
        let currentExam = null;
        let currentQuestionIndex = 0;
        let studentAnswers = [];
        let examTimer = null;
        let timeRemaining = 0;
        let lastSyncTime = null;
        
        // ===== ØªÙ‡ÙŠØ¦Ø© Firebase ÙˆØ§Ù„Ù…Ø²Ø§Ù…Ù†Ø© =====
        async function initFirebase() {
            try {
                updateLoaderStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...');
                
                // ØªÙ‡ÙŠØ¦Ø© Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                isOnline = true;
                
                updateSyncStatus('online', 'âœ“ Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
                updateLoaderStatus('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...');
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
                await loadAllDataFromFirebase();
                
                // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©
                setupRealtimeListeners();
                
                updateLoaderStatus('Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...');
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('appContainer').style.display = 'block';
                    updateSyncStatus('online', 'âœ“ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² - Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù†Ø´Ø·Ø©');
                    
                    // Ø¹Ø±Ø¶ Ø¢Ø®Ø± ÙˆÙ‚Øª Ù…Ø²Ø§Ù…Ù†Ø©
                    updateLastSyncTime();
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                    initApp();
                }, 1000);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Firebase:', error);
                updateSyncStatus('offline', 'âœ— Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·');
                updateLoaderStatus('Ø¬Ø§Ø±Ù Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©...');
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                loadDataFromLocalStorage();
                
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('appContainer').style.display = 'block';
                    updateLoaderStatus('');
                    initApp();
                }, 1500);
            }
        }
        
        // ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© =====
        async function loadAllDataFromFirebase() {
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨
                const studentsSnapshot = await db.collection('students').get();
                students = [];
                studentsSnapshot.forEach(doc => {
                    students.push({ id: doc.id, ...doc.data() });
                });
                localStorage.setItem('students', JSON.stringify(students));
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                const questionsSnapshot = await db.collection('questions').get();
                questions = [];
                questionsSnapshot.forEach(doc => {
                    questions.push({ id: doc.id, ...doc.data() });
                });
                localStorage.setItem('questions', JSON.stringify(questions));
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
                const examsSnapshot = await db.collection('exams').get();
                exams = [];
                examsSnapshot.forEach(doc => {
                    exams.push({ id: doc.id, ...doc.data() });
                });
                localStorage.setItem('exams', JSON.stringify(exams));
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                const resultsSnapshot = await db.collection('results').get();
                results = [];
                resultsSnapshot.forEach(doc => {
                    results.push({ id: doc.id, ...doc.data() });
                });
                localStorage.setItem('results', JSON.stringify(results));
                
                lastSyncTime = new Date();
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                throw error;
            }
        }
        
        function loadDataFromLocalStorage() {
            students = JSON.parse(localStorage.getItem('students')) || [];
            questions = JSON.parse(localStorage.getItem('questions')) || [];
            exams = JSON.parse(localStorage.getItem('exams')) || [];
            results = JSON.parse(localStorage.getItem('results')) || [];
            console.log('ğŸ“‚ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ');
        }
        
        function setupRealtimeListeners() {
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø§Ø¨
            db.collection('students').onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added' || change.type === 'modified') {
                        const studentData = { id: change.doc.id, ...change.doc.data() };
                        const index = students.findIndex(s => s.id === studentData.id);
                        
                        if (index === -1) {
                            students.push(studentData);
                        } else {
                            students[index] = studentData;
                        }
                        
                        localStorage.setItem('students', JSON.stringify(students));
                        
                        if (currentMode === 'teacher' && document.getElementById('students').style.display === 'block') {
                            displayStudents();
                        }
                        
                        updateSyncStatus('pending', 'ğŸ”„ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ...');
                        setTimeout(() => updateSyncStatus('online', 'âœ“ Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…'), 500);
                    }
                });
            });
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            db.collection('questions').onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added' || change.type === 'modified') {
                        const questionData = { id: change.doc.id, ...change.doc.data() };
                        const index = questions.findIndex(q => q.id === questionData.id);
                        
                        if (index === -1) {
                            questions.push(questionData);
                        } else {
                            questions[index] = questionData;
                        }
                        
                        localStorage.setItem('questions', JSON.stringify(questions));
                        
                        if (currentMode === 'teacher' && document.getElementById('questions').style.display === 'block') {
                            displayQuestions();
                        }
                    }
                });
            });
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
            db.collection('exams').onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added' || change.type === 'modified') {
                        const examData = { id: change.doc.id, ...change.doc.data() };
                        const index = exams.findIndex(e => e.id === examData.id);
                        
                        if (index === -1) {
                            exams.push(examData);
                        } else {
                            exams[index] = examData;
                        }
                        
                        localStorage.setItem('exams', JSON.stringify(exams));
                        
                        if (currentMode === 'teacher' && document.getElementById('exams').style.display === 'block') {
                            displayExams();
                        }
                    }
                });
            });
            
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            db.collection('results').onSnapshot((snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === 'added' || change.type === 'modified') {
                        const resultData = { id: change.doc.id, ...change.doc.data() };
                        const index = results.findIndex(r => r.id === resultData.id);
                        
                        if (index === -1) {
                            results.push(resultData);
                        } else {
                            results[index] = resultData;
                        }
                        
                        localStorage.setItem('results', JSON.stringify(results));
                        
                        if (currentMode === 'teacher' && document.getElementById('results').style.display === 'block') {
                            displayResults();
                        }
                    }
                });
            });
        }
        
        async function saveToFirebase(collection, data) {
            if (!isOnline) return null;
            
            try {
                let docRef;
                if (data.id) {
                    const { id, ...dataWithoutId } = data;
                    docRef = await db.collection(collection).doc(id).set(dataWithoutId, { merge: true });
                } else {
                    docRef = await db.collection(collection).add(data);
                    data.id = docRef.id;
                }
                
                lastSyncTime = new Date();
                updateLastSyncTime();
                updateSyncStatus('pending', 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...');
                setTimeout(() => updateSyncStatus('online', 'âœ“ Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…'), 1000);
                
                return data.id || docRef.id;
            } catch (error) {
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ ${collection}:`, error);
                updateSyncStatus('offline', 'âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                return null;
            }
        }
        
        async function deleteFromFirebase(collection, id) {
            if (!isOnline) return false;
            
            try {
                await db.collection(collection).doc(id).delete();
                lastSyncTime = new Date();
                updateLastSyncTime();
                return true;
            } catch (error) {
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù ${collection}:`, error);
                return false;
            }
        }
        
        function updateSyncStatus(status, message) {
            const statusBar = document.getElementById('syncStatusBar');
            statusBar.className = `sync-status-bar sync-${status}`;
            statusBar.innerHTML = `
                <i class="fas fa-${status === 'online' ? 'cloud' : status === 'offline' ? 'wifi' : 'sync-alt'} ${status === 'pending' ? 'fa-spin' : ''}"></i>
                <span>${message}</span>
            `;
        }
        
        function updateLoaderStatus(message) {
            document.getElementById('loaderStatus').textContent = message;
        }
        
        function updateLastSyncTime() {
            if (lastSyncTime) {
                const timeStr = lastSyncTime.toLocaleTimeString('ar-SA');
                document.getElementById('lastSyncTime').textContent = `Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©: ${timeStr}`;
            }
        }
        
        async function forceSync() {
            if (!isOnline) {
                alert('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                return;
            }
            
            updateSyncStatus('pending', 'ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...');
            
            try {
                // Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¥Ù„Ù‰ Firebase
                for (const student of students) {
                    await saveToFirebase('students', student);
                }
                
                for (const question of questions) {
                    await saveToFirebase('questions', question);
                }
                
                for (const exam of exams) {
                    await saveToFirebase('exams', exam);
                }
                
                for (const result of results) {
                    await saveToFirebase('results', result);
                }
                
                // ØªØ­Ù…ÙŠÙ„ Ø£Ø­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
                await loadAllDataFromFirebase();
                
                updateSyncStatus('online', 'âœ“ ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­');
                alert('âœ… ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:', error);
                updateSyncStatus('offline', 'âœ— ÙØ´Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                alert('âŒ ÙØ´Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©: ' + error.message);
            }
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª =====
        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabContents.forEach(content => {
                content.style.display = 'none';
            });
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => {
                        c.style.display = 'none';
                        c.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    const targetTab = document.getElementById(tabId);
                    if (targetTab) {
                        targetTab.style.display = 'block';
                        targetTab.classList.add('active');
                        
                        switch(tabId) {
                            case 'students':
                                displayStudents();
                                break;
                            case 'questions':
                                displayQuestions();
                                loadQuestionsList();
                                break;
                            case 'exams':
                                displayExams();
                                break;
                            case 'results':
                                displayResults();
                                break;
                        }
                    }
                });
            });
            
            if (tabBtns.length > 0) {
                tabBtns[0].click();
            }
        }
        
        function switchMode(mode) {
            currentMode = mode;
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (mode === 'teacher') {
                document.getElementById('teacherMode').style.display = 'block';
                document.getElementById('studentMode').style.display = 'none';
                document.querySelector('.mode-btn[onclick="switchMode(\'teacher\')"]').classList.add('active');
                initTabs();
            } else {
                document.getElementById('teacherMode').style.display = 'none';
                document.getElementById('studentMode').style.display = 'block';
                document.querySelector('.mode-btn[onclick="switchMode(\'student\')"]').classList.add('active');
                
                document.getElementById('studentLoginScreen').style.display = 'block';
                document.getElementById('studentExamScreen').style.display = 'none';
                document.getElementById('studentResultScreen').style.display = 'none';
                
                document.getElementById('loginCivilId').value = '';
                document.getElementById('loginExamCode').value = '';
                document.getElementById('loginError').style.display = 'none';
            }
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ =====
        async function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const civilId = document.getElementById('studentCivilId').value.trim();
            const studentClass = document.getElementById('studentClass').value;
            
            if (!name || !civilId) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }
            
            if (students.some(s => s.civilId === civilId)) {
                alert('âŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
                return;
            }
            
            const newStudent = {
                name,
                civilId,
                class: studentClass,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
            const localId = 'student_' + Date.now();
            newStudent.id = localId;
            students.push(newStudent);
            localStorage.setItem('students', JSON.stringify(students));
            
            // Ø­ÙØ¸ ÙÙŠ Firebase
            const firebaseId = await saveToFirebase('students', newStudent);
            if (firebaseId && firebaseId !== localId) {
                newStudent.id = firebaseId;
                const index = students.findIndex(s => s.id === localId);
                if (index !== -1) students[index] = newStudent;
                localStorage.setItem('students', JSON.stringify(students));
            }
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('studentName').value = '';
            document.getElementById('studentCivilId').value = '';
            
            displayStudents();
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function displayStudents() {
            const table = document.getElementById('studentsTable');
            if (!table) return;
            
            if (students.length === 0) {
                table.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-users-slash"></i> Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯
                    </div>
                `;
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ</th>
                            <th>Ø§Ù„ØµÙ</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            students.forEach((student, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${student.name}</td>
                        <td>${student.civilId}</td>
                        <td>${student.class}</td>
                        <td>${new Date(student.createdAt).toLocaleDateString('ar-SA')}</td>
                        <td>
                            <button onclick="deleteStudent('${student.id}')" class="btn-danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <div style="margin-top: 15px;">
                    <p><i class="fas fa-users"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨: ${students.length}</p>
                </div>
            `;
            
            table.innerHTML = html;
        }
        
        async function deleteStudent(studentId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ØŸ')) return;
            
            // Ø­Ø°Ù Ù…Ø­Ù„ÙŠ
            students = students.filter(s => s.id !== studentId);
            localStorage.setItem('students', JSON.stringify(students));
            
            // Ø­Ø°Ù Ù…Ù† Firebase
            if (isOnline) {
                await deleteFromFirebase('students', studentId);
            }
            
            displayStudents();
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© =====
        function toggleQuestionOptions() {
            const type = document.getElementById('questionType').value;
            if (type === 'mcq') {
                document.getElementById('mcqOptions').style.display = 'block';
                document.getElementById('essayOptions').style.display = 'none';
            } else {
                document.getElementById('mcqOptions').style.display = 'none';
                document.getElementById('essayOptions').style.display = 'block';
            }
        }
        
        function addOption() {
            const container = document.getElementById('optionsContainer');
            const index = container.children.length;
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-item';
            optionDiv.style.display = 'flex';
            optionDiv.style.alignItems = 'center';
            optionDiv.style.gap = '10px';
            optionDiv.style.marginBottom = '10px';
            optionDiv.innerHTML = `
                <input type="radio" name="correctOption" value="${index}">
                <input type="text" class="form-control option-text" placeholder="Ø®ÙŠØ§Ø± Ø¬Ø¯ÙŠØ¯" data-index="${index}">
                <button class="btn-danger" onclick="removeOption(${index})" style="padding: 5px 10px;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(optionDiv);
        }
        
        function removeOption(index) {
            const options = document.querySelectorAll('.option-item');
            if (options.length <= 2) {
                alert('âŒ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø®ÙŠØ§Ø±Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            
            options[index].remove();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
            const remainingOptions = document.querySelectorAll('.option-item');
            remainingOptions.forEach((opt, i) => {
                const radio = opt.querySelector('input[type="radio"]');
                const input = opt.querySelector('input[type="text"]');
                const button = opt.querySelector('button');
                
                radio.value = i;
                input.dataset.index = i;
                button.onclick = () => removeOption(i);
            });
        }
        
        async function saveQuestion() {
            const text = document.getElementById('questionText').value.trim();
            const type = document.getElementById('questionType').value;
            const subject = document.getElementById('questionSubject').value;
            const score = parseInt(document.getElementById('questionScore').value) || 1;
            
            if (!text) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„');
                return;
            }
            
            let questionData = {
                text,
                type,
                subject,
                score,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (type === 'mcq') {
                const options = [];
                const optionElements = document.querySelectorAll('.option-text');
                
                if (optionElements.length < 2) {
                    alert('âŒ ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                    return;
                }
                
                optionElements.forEach((input, index) => {
                    const optionText = input.value.trim();
                    if (optionText) {
                        const isCorrect = document.querySelector(`input[name="correctOption"][value="${index}"]`).checked;
                        options.push({
                            text: optionText,
                            isCorrect: isCorrect
                        });
                    }
                });
                
                if (options.length < 2) {
                    alert('âŒ ÙŠØ¬Ø¨ Ø¥ÙƒÙ…Ø§Ù„ Ù†Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª');
                    return;
                }
                
                const hasCorrect = options.some(opt => opt.isCorrect);
                if (!hasCorrect) {
                    alert('âŒ ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©');
                    return;
                }
                
                questionData.options = options;
            }
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
            const localId = 'question_' + Date.now();
            questionData.id = localId;
            questions.push(questionData);
            localStorage.setItem('questions', JSON.stringify(questions));
            
            // Ø­ÙØ¸ ÙÙŠ Firebase
            const firebaseId = await saveToFirebase('questions', questionData);
            if (firebaseId && firebaseId !== localId) {
                questionData.id = firebaseId;
                const index = questions.findIndex(q => q.id === localId);
                if (index !== -1) questions[index] = questionData;
                localStorage.setItem('questions', JSON.stringify(questions));
            }
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('questionText').value = '';
            
            displayQuestions();
            loadQuestionsList();
            alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function displayQuestions() {
            const table = document.getElementById('questionsTable');
            if (!table) return;
            
            if (questions.length === 0) {
                table.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-question-circle"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯
                    </div>
                `;
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            questions.forEach((question, index) => {
                const typeBadge = question.type === 'mcq' ? 
                    '<span style="background:#4fc3a1; color:white; padding:3px 8px; border-radius:5px;">Ø§Ø®ØªÙŠØ§Ø±</span>' :
                    '<span style="background:#4a6fa5; color:white; padding:3px 8px; border-radius:5px;">Ù…Ù‚Ø§Ù„ÙŠ</span>';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td style="max-width: 300px;">${question.text.substring(0, 100)}${question.text.length > 100 ? '...' : ''}</td>
                        <td>${typeBadge}</td>
                        <td>${question.subject}</td>
                        <td>${question.score}</td>
                        <td>
                            <button onclick="deleteQuestion('${question.id}')" class="btn-danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                <div style="margin-top: 15px;">
                    <p><i class="fas fa-question-circle"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: ${questions.length}</p>
                </div>
            `;
            
            table.innerHTML = html;
        }
        
        function loadQuestionsList() {
            const container = document.getElementById('questionsList');
            if (!container) return;
            
            if (questions.length === 0) {
                container.innerHTML = '<p class="alert alert-warning">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ§Ø­Ø©</p>';
                return;
            }
            
            let html = '';
            questions.forEach((question, index) => {
                const typeIcon = question.type === 'mcq' ? 'fa-list-ol' : 'fa-pen-alt';
                
                html += `
                    <div style="border:1px solid #ddd; padding:10px; margin-bottom:10px; border-radius:5px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <input type="checkbox" id="q_${question.id}" value="${question.id}">
                                <label for="q_${question.id}" style="margin-right:10px; cursor:pointer;">
                                    <strong>${index + 1}. ${question.text.substring(0, 50)}${question.text.length > 50 ? '...' : ''}</strong>
                                </label>
                            </div>
                            <div>
                                <span style="background:#f8f9fa; padding:2px 8px; border-radius:3px; font-size:0.9em;">
                                    <i class="fas ${typeIcon}"></i> ${question.score} Ø¯Ø±Ø¬Ø©
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        async function deleteQuestion(questionId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) return;
            
            // Ø­Ø°Ù Ù…Ø­Ù„ÙŠ
            questions = questions.filter(q => q.id !== questionId);
            localStorage.setItem('questions', JSON.stringify(questions));
            
            // Ø­Ø°Ù Ù…Ù† Firebase
            if (isOnline) {
                await deleteFromFirebase('questions', questionId);
            }
            
            displayQuestions();
            loadQuestionsList();
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª =====
        async function createExam() {
            const name = document.getElementById('examName').value.trim();
            const subject = document.getElementById('examSubject').value;
            const duration = parseInt(document.getElementById('examDuration').value) || 60;
            const date = document.getElementById('examDate').value;
            
            if (!name) {
                alert('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                return;
            }
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
            const selectedQuestions = [];
            document.querySelectorAll('#questionsList input[type="checkbox"]:checked').forEach(checkbox => {
                selectedQuestions.push(checkbox.value);
            });
            
            if (selectedQuestions.length === 0) {
                alert('âŒ ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø£Ø³Ø¦Ù„Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                return;
            }
            
            // ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            const examCode = 'EXAM' + Math.random().toString(36).substr(2, 6).toUpperCase();
            
            const examData = {
                name,
                subject,
                duration,
                date: date || new Date().toISOString().split('T')[0],
                code: examCode,
                questions: selectedQuestions,
                status: 'active',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
            const localId = 'exam_' + Date.now();
            examData.id = localId;
            exams.push(examData);
            localStorage.setItem('exams', JSON.stringify(exams));
            
            // Ø­ÙØ¸ ÙÙŠ Firebase
            const firebaseId = await saveToFirebase('exams', examData);
            if (firebaseId && firebaseId !== localId) {
                examData.id = firebaseId;
                const index = exams.findIndex(e => e.id === localId);
                if (index !== -1) exams[index] = examData;
                localStorage.setItem('exams', JSON.stringify(exams));
            }
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('examName').value = '';
            document.getElementById('examDuration').value = '60';
            document.getElementById('examDate').value = '';
            
            // Ø¥Ù„ØºØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            document.querySelectorAll('#questionsList input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            displayExams();
            alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­\nÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${examCode}\nØ´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ Ø§Ù„Ø·Ù„Ø§Ø¨`);
        }
        
        function displayExams() {
            const table = document.getElementById('examsTable');
            if (!table) return;
            
            if (exams.length === 0) {
                table.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-file-alt"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯
                    </div>
                `;
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th>
                            <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                            <th>ÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</th>
                            <th>Ø§Ù„Ù…Ø¯Ø©</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            exams.forEach((exam, index) => {
                const statusBadge = exam.status === 'active' ? 
                    '<span style="background:#28a745; color:white; padding:3px 8px; border-radius:5px;">Ù†Ø´Ø·</span>' :
                    '<span style="background:#dc3545; color:white; padding:3px 8px; border-radius:5px;">Ù…ØºÙ„Ù‚</span>';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${exam.name}</td>
                        <td>${exam.subject}</td>
                        <td><strong>${exam.code}</strong></td>
                        <td>${exam.questions.length}</td>
                        <td>${exam.duration} Ø¯Ù‚ÙŠÙ‚Ø©</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button onclick="copyExamCode('${exam.code}')" class="btn-secondary" style="padding:5px 10px; margin:2px;">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button onclick="deleteExam('${exam.id}')" class="btn-danger" style="padding:5px 10px; margin:2px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            table.innerHTML = html;
        }
        
        function copyExamCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                alert(`âœ… ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${code}`);
            });
        }
        
        async function deleteExam(examId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ')) return;
            
            // Ø­Ø°Ù Ù…Ø­Ù„ÙŠ
            exams = exams.filter(e => e.id !== examId);
            localStorage.setItem('exams', JSON.stringify(exams));
            
            // Ø­Ø°Ù Ù…Ù† Firebase
            if (isOnline) {
                await deleteFromFirebase('exams', examId);
            }
            
            displayExams();
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        // ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ =====
        function displayResults() {
            displayStats();
            displayResultsTable();
        }
        
        function displayStats() {
            const grid = document.getElementById('statsGrid');
            if (!grid) return;
            
            const totalStudents = students.length;
            const totalExams = exams.length;
            const totalQuestions = questions.length;
            const totalResults = results.length;
            
            grid.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="background: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); text-align: center;">
                        <div style="background: var(--primary-color); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin: 0 auto 10px;">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3 style="margin: 0; color: var(--primary-color);">${totalStudents}</h3>
                        <p style="margin: 5px 0 0 0; color: #666;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); text-align: center;">
                        <div style="background: var(--accent-color); color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin: 0 auto 10px;">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h3 style="margin: 0; color: var(--accent-color);">${totalExams}</h3>
                        <p style="margin: 5px 0 0 0; color: #666;">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</p>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); text-align: center;">
                        <div style="background: #ffc107; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin: 0 auto 10px;">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <h3 style="margin: 0; color: #ffc107;">${totalQuestions}</h3>
                        <p style="margin: 5px 0 0 0; color: #666;">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</p>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: var(--border-radius); box-shadow: var(--shadow); text-align: center;">
                        <div style="background: #28a745; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin: 0 auto 10px;">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 style="margin: 0; color: #28a745;">${totalResults}</h3>
                        <p style="margin: 5px 0 0 0; color: #666;">Ø³Ø¬Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>
                    </div>
                </div>
            `;
        }
        
        function displayResultsTable() {
            const table = document.getElementById('resultsTable');
            if (!table) return;
            
            if (results.length === 0) {
                table.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-chart-bar"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯
                    </div>
                `;
                return;
            }
            
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                            <th>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th>
                            <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                            <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            results.forEach((result, index) => {
                const percentage = ((result.score / result.totalScore) * 100).toFixed(1);
                const color = percentage >= 50 ? '#28a745' : percentage >= 25 ? '#ffc107' : '#dc3545';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${result.studentName}</td>
                        <td>${result.examName}</td>
                        <td>${result.score}/${result.totalScore}</td>
                        <td style="color:${color}; font-weight:bold;">${percentage}%</td>
                        <td>${new Date(result.submittedAt).toLocaleDateString('ar-SA')}</td>
                        <td>
                            <span style="background:#${result.status === 'graded' ? '28a745' : 'ffc107'}; color:white; padding:3px 8px; border-radius:5px;">
                                ${result.status === 'graded' ? 'Ù…ØµØ­Ø­' : 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØµØ­ÙŠØ­'}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            table.innerHTML = html;
        }
        
        // ===== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ =====
        function studentLogin() {
            const civilId = document.getElementById('loginCivilId').value.trim();
            const examCode = document.getElementById('loginExamCode').value.trim().toUpperCase();
            
            if (!civilId || !examCode) {
                showLoginError('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ ÙˆÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                return;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ø§Ù„Ø¨
            const student = students.find(s => s.civilId === civilId);
            if (!student) {
                showLoginError('âŒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…');
                return;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            const exam = exams.find(e => e.code === examCode && e.status === 'active');
            if (!exam) {
                showLoginError('âŒ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©');
                return;
            }
            
            currentStudent = student;
            currentExam = exam;
            studentAnswers = [];
            currentQuestionIndex = 0;
            
            // ØªØ­Ù…ÙŠÙ„ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            currentExam.questionsData = currentExam.questions.map(qId => 
                questions.find(q => q.id === qId)
            ).filter(q => q);
            
            if (currentExam.questionsData.length === 0) {
                showLoginError('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±');
                return;
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
            currentExam.questionsData.forEach((question, index) => {
                studentAnswers.push({
                    questionId: question.id,
                    questionText: question.text,
                    type: question.type,
                    answer: '',
                    score: 0,
                    maxScore: question.score
                });
            });
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø¤Ù‚Øª
            timeRemaining = currentExam.duration * 60;
            updateTimerDisplay();
            
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
            document.getElementById('studentLoginScreen').style.display = 'none';
            document.getElementById('studentExamScreen').style.display = 'block';
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
            document.getElementById('studentInfo').textContent = currentStudent.name;
            document.getElementById('examInfo').textContent = currentExam.name;
            document.getElementById('subjectInfo').textContent = currentExam.subject;
            document.getElementById('examCodeInfo').textContent = currentExam.code;
            
            // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
            startTimer();
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            displayCurrentQuestion();
        }
        
        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            errorDiv.style.display = 'block';
        }
        
        function startTimer() {
            if (examTimer) clearInterval(examTimer);
            
            examTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(examTimer);
                    submitExam();
                    alert('â° Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±! ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹');
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timeRemaining').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function displayCurrentQuestion() {
            const container = document.getElementById('examQuestionsContainer');
            const question = currentExam.questionsData[currentQuestionIndex];
            
            if (!question) return;
            
            let html = `
                <div class="question-card">
                    <div class="question-number">${currentQuestionIndex + 1}</div>
                    <div class="question-text">${question.text}</div>
            `;
            
            if (question.type === 'mcq' && question.options) {
                html += `<div class="options-container">`;
                
                question.options.forEach((option, index) => {
                    const isSelected = studentAnswers[currentQuestionIndex].answer === option.text;
                    
                    html += `
                        <label class="option-label ${isSelected ? 'selected' : ''}">
                            <input type="radio" 
                                   name="question_${currentQuestionIndex}" 
                                   value="${option.text}"
                                   ${isSelected ? 'checked' : ''}
                                   onchange="selectAnswer('${option.text}')"
                                   style="margin-left: 10px;">
                            ${option.text}
                        </label>
                    `;
                });
                
                html += `</div>`;
            } else if (question.type === 'essay') {
                const currentAnswer = studentAnswers[currentQuestionIndex].answer;
                
                html += `
                    <div class="form-group">
                        <textarea id="essayAnswer" class="form-control" rows="4" 
                                  placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..."
                                  oninput="saveEssayAnswer(this.value)">${currentAnswer}</textarea>
                    </div>
                `;
            }
            
            html += `</div>`;
            container.innerHTML = html;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            document.getElementById('questionCounter').textContent = 
                `Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestionIndex + 1} Ù…Ù† ${currentExam.questionsData.length}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').disabled = currentQuestionIndex === currentExam.questionsData.length - 1;
        }
        
        function selectAnswer(answer) {
            studentAnswers[currentQuestionIndex].answer = answer;
        }
        
        function saveEssayAnswer(answer) {
            studentAnswers[currentQuestionIndex].answer = answer;
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayCurrentQuestion();
            }
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < currentExam.questionsData.length - 1) {
                currentQuestionIndex++;
                displayCurrentQuestion();
            }
        }
        
        async function submitExam() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ')) return;
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
            if (examTimer) {
                clearInterval(examTimer);
                examTimer = null;
            }
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            let totalScore = 0;
            let maxScore = 0;
            
            studentAnswers.forEach((answer, index) => {
                const question = currentExam.questionsData[index];
                maxScore += question.score;
                
                if (question.type === 'mcq' && question.options) {
                    const correctOption = question.options.find(opt => opt.isCorrect);
                    if (correctOption && answer.answer === correctOption.text) {
                        answer.score = question.score;
                        totalScore += question.score;
                    }
                }
            });
            
            // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            const resultData = {
                studentId: currentStudent.id,
                studentName: currentStudent.name,
                studentCivilId: currentStudent.civilId,
                examId: currentExam.id,
                examName: currentExam.name,
                examCode: currentExam.code,
                score: totalScore,
                totalScore: maxScore,
                answers: studentAnswers,
                status: 'pending',
                submittedAt: new Date().toISOString(),
                timeSpent: (currentExam.duration * 60) - timeRemaining
            };
            
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
            const localId = 'result_' + Date.now();
            resultData.id = localId;
            results.push(resultData);
            localStorage.setItem('results', JSON.stringify(results));
            
            // Ø­ÙØ¸ ÙÙŠ Firebase
            const firebaseId = await saveToFirebase('results', resultData);
            if (firebaseId && firebaseId !== localId) {
                resultData.id = firebaseId;
                const index = results.findIndex(r => r.id === localId);
                if (index !== -1) results[index] = resultData;
                localStorage.setItem('results', JSON.stringify(results));
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨
            document.getElementById('studentExamScreen').style.display = 'none';
            document.getElementById('studentResultScreen').style.display = 'block';
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            const percentage = ((totalScore / maxScore) * 100).toFixed(1);
            const resultDetails = document.getElementById('resultDetails');
            resultDetails.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h3 style="color:${percentage >= 50 ? '#28a745' : '#dc3545'};">${percentage}%</h3>
                    <p><strong>Ø§Ù„Ø¯Ø±Ø¬Ø©:</strong> ${totalScore}/${maxScore}</p>
                    <p><strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:</strong> ${Math.floor(resultData.timeSpent / 60)}:${(resultData.timeSpent % 60).toString().padStart(2, '0')}</p>
                    <p><strong>ÙˆÙ‚Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…:</strong> ${new Date().toLocaleString('ar-SA')}</p>
                    <div class="alert alert-info" style="margin-top: 20px;">
                        <i class="fas fa-info-circle"></i> ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¹Ù„Ù… ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠØ© Ù„Ø§Ø­Ù‚Ø§Ù‹
                    </div>
                </div>
            `;
        }
        
        function backToLogin() {
            currentStudent = null;
            currentExam = null;
            studentAnswers = [];
            currentQuestionIndex = 0;
            
            if (examTimer) {
                clearInterval(examTimer);
                examTimer = null;
            }
            
            document.getElementById('studentResultScreen').style.display = 'none';
            document.getElementById('studentLoginScreen').style.display = 'block';
            document.getElementById('loginCivilId').value = '';
            document.getElementById('loginExamCode').value = '';
            document.getElementById('loginError').style.display = 'none';
        }
        
        // ===== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØµØ¯ÙŠØ± =====
        function exportResults() {
            if (results.length === 0) {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§');
                return;
            }
            
            const csv = convertToCSV(results);
            downloadCSV(csv, 'Ù†ØªØ§Ø¦Ø¬_Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª.csv');
            alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function exportStudents() {
            if (students.length === 0) {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ù„Ø§Ø¨ Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§');
                return;
            }
            
            const csv = convertToCSV(students);
            downloadCSV(csv, 'Ù‚Ø§Ø¦Ù…Ø©_Ø§Ù„Ø·Ù„Ø§Ø¨.csv');
            alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function backupData() {
            const backup = {
                students,
                questions,
                exams,
                results,
                backupDate: new Date().toISOString()
            };
            
            const json = JSON.stringify(backup, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ù†Ø³Ø®Ø©_Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
        }
        
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const rows = data.map(obj => 
                headers.map(header => 
                    JSON.stringify(obj[header] || '')
                ).join(',')
            );
            
            return [headers.join(','), ...rows].join('\n');
        }
        
        function downloadCSV(csv, filename) {
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // ===== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© =====
        function initApp() {
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ®
            const now = new Date();
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('ar-SA', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
            
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            const examDateInput = document.getElementById('examDate');
            if (examDateInput) {
                examDateInput.value = now.toISOString().split('T')[0];
            }
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            initTabs();
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            switchMode('teacher');
            
            console.log('âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            initFirebase();
        });
    </script>
</body>
</html>
